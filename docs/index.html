<!doctype html>
<html lang="en">
  <head>
	<meta name="generator" content="Hugo 0.54.0" />
    <meta charset="utf-8">
<title>Introduction to Kubernetes</title>


<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="stylesheet" href="/louk8cnc-intro-k8s/reveal-js/css/reveal.css"><link rel="stylesheet" href="/louk8cnc-intro-k8s/reveal-js/css/theme/black.css" id="theme">
<link rel="stylesheet" href="/louk8cnc-intro-k8s/highlight-js/color-brewer.min.css">
    

<style>
 
.reveal section pre {
  box-shadow: none;
  margin-top: 25px;
  margin-bottom: 25px;
  border: 1px solid lightgrey;
}
.reveal section pre:hover {
  border: 1px solid grey;
  transition: border 0.3s ease;
}
.reveal section pre > code {
  padding: 10px;
}
.reveal table {
  font-size: 0.65em;
}
 
.reveal section.side-by-side h1 {
  position: absolute;
}
.reveal section.side-by-side h1:first-of-type {
  left: 25%;
}
.reveal section.side-by-side h1:nth-of-type(2) {
  right: 25%;
}
.reveal section[data-background-image] a,
.reveal section[data-background-image] p,
.reveal section[data-background-image] h2 {
  color: white;
}
.reveal section[data-background-image] a {
  text-decoration: underline;
}
</style>

  </head>
  <body>
    <div class="reveal">
      <div class="slides">
  
<section>

<h1 id="introduction-to-kubernetes">Introduction to Kubernetes</h1>

<p>Introduction to Kubernetes is a presentation giving attendees a thorough understanding of the fundamentals of Kubernetes.</p>
</section>

  
<section>

<h1 id="whoami">whoami</h1>

<p>James Strong</p>

<p><img src="/louk8cnc-intro-k8s/images/james.png" alt="" /></p>

<p>Technical Principal @ <a href="https://contino.io">Contino</a></p>

<p>Certified Kubernetes Admin</p>

<p><a href="https://twitter.com/strongjz">@strongjz</a></p>

<p><a href="https://jamesstrong.dev">https://jamesstrong.dev</a></p>
</section><section>

<h1 id="contino">Contino</h1>

<p><img src="/louk8cnc-intro-k8s/images/contino/whois.png" alt="" /></p>
</section><section>

<h1 id="agenda">Agenda</h1>

</section><section>

<h3 id="introduction-introduction-index-html"><a href="/introduction/index.html">Introduction</a></h3>

<ul>
<li><a href="/introduction/whoami/">Presenter</a></li>
<li><a href="/introduction/contino/">Contino</a></li>
<li><a href="/introduction/agenda/">Agenda</a></li>
</ul>

</section><section>

<h3 id="containers-containers"><a href="/containers">Containers</a></h3>

<ul>
<li><a href="/containers/intro">Intro</a></li>
<li><a href="/containers/history">History</a></li>
<li><a href="/containers/primitives">Primitives</a></li>
<li><a href="/containers/docker">Docker</a></li>
<li><a href="/containers/network">Network</a></li>
<li><a href="/containers/storage">Storage</a>
<br /></li>
</ul>

</section><section>

<h3 id="kubernetes-kubernetes"><a href="/kubernetes/">Kubernetes</a></h3>

<ul>
<li><a href="/kubernetes/history">History</a></li>
<li><a href="/kubernetes/community">Community</a></li>
<li><a href="/kubernetes/community/projects_grad">CNCF Graduated Projects</a></li>
<li><a href="/kubernetes/community/projects_inc">CNCF Incubating Projects</a><br /></li>
<li><a href="/kubernetes/community/involvement">Get Involved</a></li>
</ul>

</section><section>

<h3 id="kubernetes-objects-kubernetes-objects"><a href="/kubernetes/objects">Kubernetes Objects</a></h3>

<ul>
<li><a href="/kubernetes/objects/namespaces">Namespaces</a></li>
<li><a href="/kubernetes/objects/pods">Pods</a></li>
<li><a href="/kubernetes/objects/resource-quotas">Resource Quotas</a></li>
<li><a href="/kubernetes/objects/controllers">Controllers</a></li>
<li><a href="/kubernetes/objects/storage">Storage</a></li>
<li><a href="/kubernetes/objects/secrets">Secrets</a></li>
<li><a href="/kubernetes/objects/configmaps">ConfigMaps</a></li>
<li><a href="/kubernetes/objects/ingress">Ingress</a></li>
<li><a href="/kubernetes/objects/services">Service</a></li>
<li><a href="/kubernetes/objects/healthchecks">Healthchecks</a></li>
</ul>

</section><section>

<h3 id="extras-kubernetes-extras"><a href="/kubernetes/extras">Extras</a></h3>

<ul>
<li><a href="/kubernetes/running">Options for Running Kubernetes</a></li>
<li><a href="/kubernetes/extras/monitoring">Monitoring</a></li>
<li><a href="/kubernetes/extras/security">Security</a></li>
</ul>
</section><section>

<h1 id="history">History</h1>

</section><section>

<h1 id="in-the-beginning">In the beginning</h1>

<p><img src="/louk8cnc-intro-k8s/images/docker/app2.png" alt="" /></p>

</section><section>

<h1 id="the-hypervisor">The Hypervisor</h1>

<p><img src="/louk8cnc-intro-k8s/images/docker/vm.png" alt="" /></p>

</section><section>

<h1 id="2007">2007</h1>

<h3 id="container-primitives">Container Primitives</h3>

<ul>
<li>Control Groups</li>
<li>Namespaces</li>
</ul>

</section><section>

<h4 id="control-groups">Control Groups</h4>

<p>Abbreviated cgroups, is a Linux kernel feature that limits, accounts for, and isolates the resource usage</p>

<ul>
<li>CPU</li>
<li>memory</li>
<li>disk I/O</li>
<li>network</li>
</ul>

</section><section>

<h4 id="namespaces">Namespaces</h4>

<p>A feature of the Linux kernel that isolate and virtualize system resources of a collection of processes. Examples of resources that can be virtualized include:</p>

<ul>
<li>process IDs</li>
<li>hostnames</li>
<li>user IDs</li>
<li>network access</li>
<li>interprocess communication</li>
<li>filesystems</li>
</ul>

</section><section>

<h1 id="containers">Containers</h1>

<p><img src="/louk8cnc-intro-k8s/images/docker/containers.png" alt="" /></p>

</section><section>

<h1 id="rise-of-the-containers-runtimes">Rise of the Containers (runtimes)</h1>

<ul>
<li>lxc</li>
<li>Docker ( containerd )</li>
<li>rkt</li>
<li>runc</li>
<li>lmctfy</li>
<li>cri-o</li>
</ul>

</section><section>

<p><img src="/louk8cnc-intro-k8s/images/container_fail.png" alt="" /></p>

</section><section>

<h1 id="the-orchestrator">The orchestrator</h1>

</section><section>

<h1 id="2010">2010</h1>

<p>Mesosphere</p>

</section><section>

<h1 id="2013">2013</h1>

<p>Docker Released</p>

<p>.1 release of Docker Compose</p>

</section><section>

<h1 id="2014">2014</h1>

<p><strong>Kubernetes</strong> released</p>

<p>Rancher Release 1.0 supports Docker Swarm, Meso and Kubernetes  Docker container runtime</p>

</section><section>

<h1 id="2016">2016</h1>

<p>Mesophere supports Docker, rkt, and appc for container runtimes</p>

</section><section>

<h1 id="2017">2017</h1>

<p>Mesophere add supports for Kubernetes</p>

</section><section>

<h1 id="2018">2018</h1>

<p>Docker EE 2.0 has support for the Kubernetes orchestrator</p>
</section><section>

<h1 id="containers-benefits">Containers Benefits</h1>

<ul>
<li>Separation of concerns</li>
<li>Developers focus on building their apps</li>
<li>System admins focus on deployment</li>
<li>Fast development cycle</li>
<li>Application portability</li>
<li>Build in one environment, ship to another</li>
<li>Scalability</li>
<li>Easily spin up new containers if needed</li>
</ul>
</section><section>

<h3 id="dockerfile-https-github-com-shahadarsh-docker-k8s-workshop-blob-master-exercises-docker-conference-details-service-dockerfile"><a href="https://github.com/shahadarsh/docker-k8s-workshop/blob/master/exercises/docker/conference-details-service/Dockerfile">Dockerfile</a></h3>

<ul>
<li>Instructions specify what to do when building the image</li>
<li>FROM instruction specifies what the base image should be</li>
<li>RUN instruction specifies a command to execute</li>
<li>Comments start with “#”</li>
<li>Remember, each line in a Dockerfile creates a new layer if it changes the state of the image</li>
<li>You need to find the right balance between having lots of layers created for the image and readability of the Dockerfile</li>
</ul>

</section><section>

<h3 id="dockerfile-https-github-com-shahadarsh-docker-k8s-workshop-blob-master-exercises-docker-conference-details-service-dockerfile-1"><a href="https://github.com/shahadarsh/docker-k8s-workshop/blob/master/exercises/docker/conference-details-service/Dockerfile">Dockerfile</a></h3>

<ul>
<li>Don’t install unnecessary packages</li>
<li>One ENTRYPOINT per Dockerfile</li>
<li>Combine similar commands into one by using “&amp;&amp;” and “\”<br /></li>
<li>Use the caching system to your advantage</li>
<li>The order of statements is important</li>
<li>Add files that are least likely to change first and the ones most likely to change last</li>
</ul>
</section><section>

<h1 id="kubernetes">Kubernetes</h1>
</section><section>

<h3 id="kubernetes-history">Kubernetes History</h3>

<p>Kubernetes is an open-source system for <strong>automating</strong> deployment, scaling, and management of containerized applications.</p>

</section><section>

<h3 id="kubernetes-history-1">Kubernetes History</h3>

<ul>
<li>Kubernetes is heavily influenced by Google’s Borg system</li>
<li>Released in 2014 when Google partnered with Linux foundation to form CNCF</li>
<li>Often called K8s which is a Numeronym</li>
<li>K[ubernete]s →  K[8]s → K8s</li>
<li>Kubernetes - Greek for helmsman or pilot</li>
<li>Kubernetes v1.0 was released on July 21, 2015</li>
</ul>

</section><section>

<h3 id="kubernetes-history-2">Kubernetes History</h3>

<p>“Kubernetes was built to radically change the way that applications are built and deployed in the cloud. Fundamentally, it was designed to give developers more velocity, efficiency, and agility”</p>

<p>Kelsey Hightower, Brendan Burns &amp; Joe Beda
-Kubernetes Up and Running Book</p>
</section><section>

<h1 id="cncf-landscape">CNCF Landscape</h1>

<p><img src="/louk8cnc-intro-k8s/images/cncf-landscape.png" alt="" /></p>

</section><section>

<h1 id="cncf-landscape-1">CNCF Landscape</h1>

<p><img src="/louk8cnc-intro-k8s/images/incubating.png" alt="" /></p>

</section><section>

<h1 id="cncf-landscape-2">CNCF Landscape</h1>

<p><img src="/louk8cnc-intro-k8s/images/graduated.png" alt="" /></p>

</section><section>

<h1 id="cncf-involvement">CNCF Involvement</h1>

<ul>
<li><p><a href="https://github.com/kubernetes/community/blob/master/sig-list.md">SIGS</a></p></li>

<li><p><a href="https://stackoverflow.com/questions/tagged/kubernetes">Stackoverflow</a></p></li>

<li><p>Slack</p>

<ul>
<li><a href="http://slack.k8s.io/">K8</a></li>
<li><a href="https://slack.cncf.io/">CNCF</a></li>
</ul></li>
</ul>
</section><section>

<h2 id="high-level-architecture-https-kubernetes-io-docs-concepts-architecture"><a href="https://kubernetes.io/docs/concepts/architecture/">High level Architecture</a></h2>

<p><img src="/louk8cnc-intro-k8s/images/arch/highlevel.png" alt="" /></p>

</section><section>

<h3 id="master-node">Master Node</h3>

</section><section>

<h3 id="master-node-1">Master Node</h3>

<ul>
<li><p>API data store: Etcd (Cluster State)</p></li>

<li><p>Controller Managers :</p>

<ul>
<li>Node Controller</li>
<li>Deployment Controller</li>
<li>ReplicaSet Controller</li>
<li>Replication Controller</li>
<li>Endpoints Controller</li>
<li>Service Account &amp; Token Controller
<br /></li>
</ul></li>

<li><p>Scheduler: Bind pod to Node</p></li>
</ul>

</section><section>

<p><img src="/louk8cnc-intro-k8s/images/arch/master.png" alt="" /></p>

</section><section>

<h3 id="worker-node">Worker Node</h3>

</section><section>

<h3 id="worker-node-1">Worker Node</h3>

<ol>
<li><p>Kubelet:</p>

<ul>
<li>cAdvisor (metrics, logs&hellip;)</li>
</ul></li>

<li><p>Container Runtime:</p>

<ul>
<li>docker</li>
</ul></li>

<li><p>Pod:</p>

<ul>
<li>Container (one or more)</li>
</ul></li>

<li><p>Kube-proxy:</p>

<ul>
<li>Used to reach services and allow communication between Nodes.</li>
</ul></li>
</ol>

</section><section>

<p><img src="/louk8cnc-intro-k8s/images/arch//node.png" alt="" /></p>

</section><section>

<h3 id="data-flow">Data Flow</h3>

<ul>
<li><p>CNI: Network Plugin in Kubelet that allows to talk to networking to get IPs for Pods and Services.</p></li>

<li><p>gRPC: API to communicate API Server to ETCD, Controller Manager and Scheduler</p></li>

<li><p>Kubelet - all K8s nodes have a kubelet that ensures that any pod assigned to it are running and configured in the desired state.</p></li>

<li><p>CRI(Container Runtime Interface) gRPC API compiled in kubelet which allows to kubelet to talk to container runtimes by using gRPC API.</p></li>

<li><p>The Container Runtime provider has to adapt it to CRI API to allow kubelet to talk to them by using OCI Standard (runc)
Initially, Kubernetes was built on top of Docker as the container runtime. Soon after, CoreOS announced the rkt container runtime and wanted Kubernetes to support it, as well. So, Kubernetes ended up supporting Docker and rkt, although this model wasn&rsquo;t very scalable in terms of adding new features or support for new container runtimes.</p></li>

<li><p>CRI consists of a protocol buffers and gRPC API, and libraries,</p></li>
</ul>

</section><section>

<h2 id="data-flow-1">Data Flow</h2>

<p><img src="/louk8cnc-intro-k8s/images/arch/flow.png" alt="" /></p>
</section><section>

<h2 id="kubernetes-api-objects">Kubernetes API Objects</h2>

<ol>
<li><a href="/kubernetes/objects/namespaces">Namespaces</a></li>
<li><a href="/kubernetes/objects/pods">Pods</a></li>
<li><a href="/kubernetes/objects/resource-quotas">Resource Quotas</a></li>
<li><a href="/kubernetes/objects/controllers">Controllers</a></li>
<li><a href="/kubernetes/objects/storage">Storage</a></li>
<li><a href="/kubernetes/objects/secrets">Secrets</a></li>
<li><a href="/kubernetes/objects/configmaps">ConfigMaps</a></li>
<li><a href="/kubernetes/objects/ingress">Ingress</a></li>
<li><a href="/kubernetes/objects/services">Service</a></li>
<li><a href="/kubernetes/objects/healthchecks">Healthchecks</a></li>
</ol>
</section><section>

<h3 id="namespaces-https-kubernetes-io-docs-concepts-overview-working-with-objects-namespaces"><a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/namespaces/">Namespaces</a></h3>

<h3 id="louk8cnc-intro-k8s-images-kubernetes-ns-png"><img src="/louk8cnc-intro-k8s/images/kubernetes/ns.png" alt="" /></h3>

</section><section>

<h3 id="namespaces">Namespaces</h3>

<ul>
<li><p>Namespaces are virtual clusters inside your Kubernetes cluster that provide logically isolation (kinda) from each other.</p></li>

<li><p>Scope of names</p></li>

<li><p>Organization of Kubernetes resources</p></li>
</ul>
</section><section>

<h3 id="pods">Pods</h3>

<h3 id="louk8cnc-intro-k8s-images-kubernetes-pod-png"><img src="/louk8cnc-intro-k8s/images/kubernetes/pod.png" alt="" /></h3>

</section><section>

<h3 id="pods-1">Pods</h3>

<ul>
<li><p>Pods are a collection of containers that share a namespace, are colocated and scheduled together on Kubenetes nodes.</p></li>

<li><p>A pod is a group of one or more containers, with shared storage/network, and a specification for how to run the containers</p></li>
</ul>

</section><section>

<h3 id="pods-https-kubernetes-io-docs-concepts-workloads-pods-pod"><a href="https://kubernetes.io/docs/concepts/workloads/pods/pod/">Pods</a></h3>

<p><img src="/louk8cnc-intro-k8s/images/pods.png" alt="" /></p>

</section><section>

<h3 id="labels">Labels</h3>

<p>Labels are key/value pairs that are attached to objects, such as pods that help to identify that object.</p>

<h3 id="selectors">Selectors</h3>

<p>Label Selectors help client/user identify a set of objects.</p>

<pre><code class="language-yaml">spec:
  selector:
    matchLabels:
      app: mysql
  strategy:
    type: Recreate
  template:
    metadata:
      labels:
        app: mysql
</code></pre>

</section><section>

<h3 id="demo">Demo</h3>

<p>Create labels &amp; use selector to identify set of objects</p>
</section><section>

<h3 id="resource-quotas">Resource Quotas</h3>

<h3 id="louk8cnc-intro-k8s-images-kubernetes-rq-png"><img src="/louk8cnc-intro-k8s/images/kubernetes/rq.png" alt="" /></h3>

</section><section>

<h3 id="resource-quotas-1">Resource Quotas</h3>

<ul>
<li><p>Requests - How much does this pod need to run</p></li>

<li><p>Limits - This pod only gets this much to run</p></li>
</ul>

<p>Kubernetes being a multi-tenant environment, some applications may hog resources and starve others,
Resource Quotas discourage this behavior</p>

</section><section>

<h4 id="resources">Resources</h4>

<ul>
<li>CPU</li>
<li>Memory</li>
<li>Storage

<ul>
<li>requests.storage</li>
<li>persistentvolumeclaims</li>
<li>storage-class-name.storageclass.storage.k8s.io/requests.storage</li>
<li>storage-class-name.storageclass.storage.k8s.io/persistentvolumeclaims</li>
</ul></li>
</ul>

</section><section>

<h4 id="resources-1">Resources</h4>

<ul>
<li>Object Count

<ul>
<li>configmaps</li>
<li>persistentvolumeclaims</li>
<li>pods</li>
<li>replicationcontrollers</li>
<li>resourcequotas</li>
<li>services</li>
<li>services.loadbalancers</li>
<li>services.nodeports</li>
<li>secrets</li>
</ul></li>
<li>Priority - low, medium, high</li>
</ul>

<p><a href="https://kubernetes.io/docs/tasks/administer-cluster/manage-resources/quota-memory-cpu-namespace/">More info</a></p>
</section><section>

<h3 id="controllers-https-kubernetes-io-docs-concepts-workloads-controllers"><a href="https://kubernetes.io/docs/concepts/workloads/controllers/">Controllers</a></h3>

<p>In Kubernetes, a controller is a control loop that watches the shared state of the cluster through the apiserver and makes changes attempting to move the current state towards the desired state. There are several in the Kubernetes Architecture that support different functions in the system.</p>

</section><section>

<p><a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/namespaces/">Namespace controller</a> - Creates and updates the Namespaces in kubernetes</p>

</section><section>

<p><a href="https://kubernetes.io/docs/reference/access-authn-authz/service-accounts-admin/">Serviceaccounts controller</a> - Manages the service accounts in the system, which are for processes to interact with Kubernetes.</p>

</section><section>

<p><a href="https://kubernetes.io/docs/reference/command-line-tools-reference/kube-controller-manager/">Node Controller</a> - Responsible for noticing and responding when nodes go down.
Service Account &amp; Token Controllers: Create default accounts and API access tokens for new namespaces.</p>

</section><section>

<p><a href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/">Deployment Controller</a> - A Deployment controller provides declarative updates for Pods and ReplicaSets.</p>

</section><section>

<p><a href="https://kubernetes.io/docs/concepts/workloads/controllers/replicationcontroller/">Replication Controller</a> - Responsible for maintaining the correct number of pods for every replication controller object in the system.</p>

</section><section>

<p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.10/#endpoints-v1-core">Endpoints Controller</a> - Populates the Endpoints object (that is, joins Services &amp; Pods). When services are created, the Endpoint controller manages the connection between services and the pods back the service.</p>

</section><section>

<h4 id="deployments">Deployments</h4>

<ul>
<li>Scaling</li>
<li>Rolling</li>
</ul>

<h4 id="replicaset">ReplicaSet</h4>

<ul>
<li>Desired state</li>
</ul>

<h4 id="strategies">Strategies</h4>

<ul>
<li>Recreate</li>
<li>RollingUpdate (default)</li>
<li>Blue/Green</li>
<li>Canary</li>
<li>A/B Testing</li>
</ul>
</section><section>

<h1 id="storage">Storage</h1>

<p><img src="/louk8cnc-intro-k8s/images/kubernetes/pv.png" alt="" /></p>

</section><section>

<h1 id="storage-1">Storage</h1>

<p>Storage like compute is another resource that must be managed. Kubernetes offers 3 types of storage</p>

<ul>
<li>Volumes</li>
<li>Persistent Volumes</li>
<li>Persistent Volume Claims</li>
</ul>

<p>The Ephemeral nature of pods and containers lead to the need for data to be have a decoupled lifecycle outside of
containers and pods.</p>

</section><section>

<h1 id="storage-classes">Storage Classes</h1>

<p>Storage classes allow cluster administrators to provide varing levels of support and types of storage to applications
in a cluster</p>

<p>Example: Storage class that will provision an AWS EBS Volumes when referenced a PVC</p>

<pre><code class="language-yaml">kind: StorageClass
apiVersion: storage.k8s.io/v1
metadata:
  name: standard
provisioner: kubernetes.io/aws-ebs
parameters:
  type: gp2
reclaimPolicy: Retain
mountOptions:
  - debug
volumeBindingMode: Immediate
</code></pre>

</section><section>

<h1 id="volume-types">Volume Types</h1>

<p>Several volume types are supported</p>

<ul>
<li>awsElasticBlockStore</li>
<li>azureDisk</li>
<li>gcePersistentDisk</li>
<li>hostPath</li>
<li>secret</li>
<li>configmaps</li>
</ul>

</section><section>

<h1 id="volume-types-example">Volume Types Example</h1>

<p>awsElasticBlockStore example yaml:</p>

<pre><code class="language-yaml">apiVersion: v1
kind: Pod
metadata:
  name: test-ebs
spec:
  containers:
  - image: k8s.gcr.io/test-webserver
    name: test-container
    volumeMounts:
    - mountPath: /test-ebs
      name: test-volume
  volumes:
  - name: test-volume
    # This AWS EBS volume must already exist.
    awsElasticBlockStore:
      volumeID: &lt;volume-id&gt;
      fsType: ext4
</code></pre>

</section><section>

<h1 id="persistent-volumes">Persistent Volumes</h1>

<p>Persistent Volumes (PV&rsquo;s) are a piece of storage provisioned in a cluster and can be used/reference in the cluster
like another other resource.</p>

<p>Provisioning - Static or Dynamic</p>

<p>Types of PV&rsquo;s</p>

<ul>
<li>GCEPersistentDisk</li>
<li>AWSElasticBlockStore</li>
<li>AzureFile</li>
<li>CephFS</li>
</ul>

</section><section>

<h1 id="example">Example</h1>

<pre><code class="language-yaml">kind: PersistentVolume
apiVersion: v1
metadata:
  name: task-pv-volume
  labels:
    type: local
spec:
  storageClassName: manual
  capacity:
    storage: 10Gi
  accessModes:
    - ReadWriteOnce
  hostPath:
    path: &quot;/mnt/data&quot;
</code></pre>

</section><section>

<h1 id="persistent-volume-claims">Persistent Volume Claims</h1>

<p>Persistent Volume Claims (PVC&rsquo;s) - Allow pods to requests and attache Persistent Volumes available in the cluster.</p>

<p>When used in with Dynamic provision and Storage Classes, PVC&rsquo;s can automatically make storage available on demand.</p>

<p>Types of PVC&rsquo;s</p>

<ul>
<li>GCEPersistentDisk</li>
<li>AWSElasticBlockStore</li>
<li>AzureFile</li>
<li>CephFS</li>
</ul>

</section><section>

<h1 id="example-1">Example</h1>

<pre><code class="language-yaml">kind: Pod
apiVersion: v1
metadata:
  name: mypod
spec:
  containers:
    - name: myfrontend
      image: nginx
      volumeMounts:
      - mountPath: &quot;/var/www/html&quot;
        name: mypd
  volumes:
    - name: mypd
      persistentVolumeClaim:
        claimName: myclaim
</code></pre>

</section><section>

<h1 id="storage-demo">Storage Demo</h1>

<p>Create a persistent volume and claim</p>

<pre><code class="language-bash">kubectl apply -f mysql-pv.yaml
</code></pre>

<p>Create a pod that will use it.</p>

<pre><code class="language-bash">kubectl apply -f mysql-pod.yaml

</code></pre>

<h3 id="clean-up">Clean up</h3>

<pre><code class="language-bash">kubectl delete -f mysql-pv.yaml

kubectl delete -f mysql-pod.yaml

</code></pre>
</section><section>

</section><section>

<h1 id="secrets">Secrets</h1>

<h3 id="louk8cnc-intro-k8s-images-kubernetes-secret-png"><img src="/louk8cnc-intro-k8s/images/kubernetes/secret.png" alt="" /></h3>

</section><section>

<h1 id="secrets-1">Secrets</h1>

<p>Kubernetes object to inject sensitive data into containers</p>

<p>Sensitive data should never be built into the container image, in order to do that, kubernetes offers Secrets.</p>

</section><section>

<h1 id="secrets-2">Secrets</h1>

<pre><code class="language-bash">echo -n 'admin' | base64
YWRtaW4=
echo -n '1f2d1e2e67df' | base64
MWYyZDFlMmU2N2Rm
</code></pre>

<p>Write a Secret that looks like this:</p>

<pre><code class="language-yaml">apiVersion: v1
kind: Secret
metadata:
  name: mysecret
type: Opaque
data:
  username: YWRtaW4=
  password: MWYyZDFlMmU2N2Rm
</code></pre>

</section><section>

<h1 id="secrets-env">Secrets ENV</h1>

<pre><code class="language-yaml">apiVersion: v1
kind: Pod
metadata:
  name: secret-env-pod
spec:
  containers:
  - name: mycontainer
    image: redis
    env:
      - name: SECRET_USERNAME
        valueFrom:
          secretKeyRef:
            name: mysecret
            key: username
      - name: SECRET_PASSWORD
        valueFrom:
          secretKeyRef:
            name: mysecret
            key: password
  restartPolicy: Never

</code></pre>

</section><section>

<h1 id="secrets-file">Secrets File</h1>

<pre><code class="language-yaml">apiVersion: v1
   kind: Pod
   metadata:
     name: mypod
   spec:
     containers:
     - name: mypod
       image: redis
       volumeMounts:
       - name: foo
         mountPath: &quot;/etc/foo&quot;
         readOnly: true
     volumes:
     - name: foo
       secret:
         secretName: mysecret
</code></pre>
</section><section>

<h1 id="configmaps">Configmaps</h1>

<h3 id="louk8cnc-intro-k8s-images-kubernetes-cm-png"><img src="/louk8cnc-intro-k8s/images/kubernetes/cm.png" alt="" /></h3>

</section><section>

<h1 id="configmaps-1">Configmaps</h1>

<p>In order to keep the immutablity of a docker image, the configuration must live outside the container image,
K8 config maps enable this.</p>

<p>Secrets, env variables, and other environment specific items should not be baked into a container image.</p>

</section><section>

<h1 id="configmaps-2">Configmaps</h1>

<p>Yaml</p>

<pre><code class="language-yaml">apiVersion: v1
data:
  game.properties: |
    enemies=aliens
    lives=3
    enemies.cheat=true
    enemies.cheat.level=noGoodRotten
    secret.code.passphrase=UUDDLRLRBABAS
    secret.code.allowed=true
    secret.code.lives=30
  ui.properties: |
    color.good=purple
    color.bad=yellow
    allow.textmode=true
    how.nice.to.look=fairlyNice
kind: ConfigMap
metadata:
  name: game-config
  namespace: default
</code></pre>

</section><section>

<h1 id="configmaps-3">Configmaps</h1>

<p>Environment Vars</p>

<pre><code class="language-yaml">apiVersion: v1
kind: Pod
metadata:
  name: dapi-test-pod
spec:
  containers:
    - name: test-container
      image: k8s.gcr.io/busybox
      command: [ &quot;/bin/sh&quot;, &quot;-c&quot;, &quot;echo $(SPECIAL_LEVEL_KEY) $(SPECIAL_TYPE_KEY)&quot; ]
      env:
        - name: SPECIAL_LEVEL_KEY
          valueFrom:
            configMapKeyRef:
              name: special-config
              key: SPECIAL_LEVEL
        - name: SPECIAL_TYPE_KEY
          valueFrom:
            configMapKeyRef:
              name: special-config
              key: SPECIAL_TYPE
  restartPolicy: Never
</code></pre>

</section><section>

<h1 id="configmaps-4">Configmaps</h1>

<p>Files from Volume mounts</p>

<pre><code class="language-yaml">apiVersion: v1
kind: Pod
metadata:
  name: dapi-test-pod
spec:
  containers:
    - name: test-container
      image: k8s.gcr.io/busybox
      command: [ &quot;/bin/sh&quot;, &quot;-c&quot;, &quot;ls /etc/config/&quot; ]
      volumeMounts:
      - name: config-volume
        mountPath: /etc/config
  volumes:
    - name: config-volume
      configMap:
        name: special-config
  restartPolicy: Never
</code></pre>
</section><section>

<h1 id="ingress">Ingress</h1>

<h3 id="louk8cnc-intro-k8s-images-kubernetes-ing-png"><img src="/louk8cnc-intro-k8s/images/kubernetes/ing.png" alt="" /></h3>

</section><section>

<h1 id="ingress-1">Ingress</h1>

<p>Ingress is a K8 object that allows external access to resources inside the cluster</p>

<p>Services, Pods and other objects are only accessible inside the cluster</p>

</section><section>

<h2 id="ingress-controllers">Ingress Controllers</h2>

<ul>
<li>In order for the ingress resource to work, the cluster must have an ingress controller running.</li>
<li>This is unlike other types of controllers, which run as part of the kube-controller-manager binary, and
are typically started automatically with a cluster.</li>
<li>Choose the ingress controller implementation that best fits your cluster.</li>
</ul>

</section><section>

<h2 id="ingress-controller">Ingress Controller</h2>

<pre><code class="language-yaml">apiVersion: extensions/v1beta1
kind: Ingress
metadata:
  name: test-ingress
spec:
  backend:
    serviceName: testsvc
    servicePort: 80
</code></pre>

</section><section>

<h2 id="ingress-controllers-1">Ingress controllers</h2>

<p>Kubernetes supported Ingress Controllers:</p>

<ul>
<li><a href="https://git.k8s.io/ingress-gce/README.md">GCE</a></li>
<li><a href="https://git.k8s.io/ingress-nginx/README.md">nginx</a></li>
</ul>

<p>Others that can be deployed:</p>

<ul>
<li><a href="http://www.haproxy.org/">HAProxy</a></li>
<li><a href="https://konghq.com/">Kong</a></li>
<li><a href="https://github.com/heptio/contour">Contour</a></li>
</ul>

<p>Full list is <a href="https://kubernetes.io/docs/concepts/services-networking/ingress/">here</a></p>

</section><section>

<h2 id="ingress-rules">Ingress Rules</h2>

<p>Each http rule contains the following information:</p>

<ul>
<li>Host</li>
<li>list of paths</li>
<li>Backend service</li>
</ul>

</section><section>

<h2 id="ingress-rule">Ingress Rule</h2>

<pre><code class="language-yaml">apiVersion: extensions/v1beta1
kind: Ingress
metadata:
  name: simple-fanout-example
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /
spec:
  rules:
  - host: foo.bar.com
    http:
      paths:
      - path: /foo
        backend:
          serviceName: service1
          servicePort: 4200
      - path: /bar
        backend:
          serviceName: service2
          servicePort: 8080

</code></pre>
</section><section>

<h1 id="services">Services</h1>

<h3 id="louk8cnc-intro-k8s-images-kubernetes-service-png"><img src="/louk8cnc-intro-k8s/images/kubernetes/service.png" alt="" /></h3>

</section><section>

<h1 id="service">Service</h1>

<p>Service: a named abstraction of software service, consisting of a port that the proxy listens on,
and the selector that determines which pods will answer requests.</p>

<p>Pods come and go, and with that their IP address change rapidly. Services decouple the IP address from the application
and serve as the IP address inside the cluster for an application running multiple pods.</p>

<p>More info <a href="https://kubernetes.io/docs/concepts/services-networking/service/">here</a></p>

</section><section>

<h1 id="service-1">Service</h1>

<h3 id="louk8cnc-intro-k8s-images-kubernetes-application-service-png"><img src="/louk8cnc-intro-k8s/images/kubernetes/application-service.png" alt="" /></h3>

</section><section>

<h3 id="application-deployment">Application Deployment</h3>

<p>Create a secret for the password between Wordpress and MYSQL</p>

<pre><code class="language-bash">kubectl create secret generic mysql-pass --from-literal=password=YOUR_PASSWORD
</code></pre>

<p>Verify it is there</p>

<pre><code>kubectl get secrets
</code></pre>

</section><section>

<h3 id="application-deployment-1">Application Deployment</h3>

<p>Deploy the service for mysql</p>

<pre><code>kubectl apply -f mysql-service.yaml
</code></pre>

<p>Verify the service has endpoints.</p>

<pre><code>kubectl get services -o wide
</code></pre>

</section><section>

<h3 id="application-deployment-2">Application Deployment</h3>

<ul>
<li><p>Pod Deployment with health checks, PersistentVolume and claim</p></li>

<li><p>Since we have created the mysql pod several times, here is a yaml file that creates it all.</p></li>
</ul>

<p>Deploy mysql</p>

<pre><code>kubectl apply -f mysql-all.yaml
</code></pre>

<p>Verify mysql deployed properly</p>

<pre><code>kubectl get deploy
</code></pre>

</section><section>

<h3 id="application-deployment-3">Application Deployment</h3>

<p>Deploy the application that will use mysqld</p>

<pre><code>kubectl apply -f app.yaml
</code></pre>

<p>Verify Service</p>

<pre><code>kubectl get services wordpress
</code></pre>

</section><section>

<h3 id="clean-up">Clean up</h3>

<pre><code class="language-bash">kubectl delete -f mysql-all.yaml
</code></pre>

<pre><code class="language-bash">kubectl delete -f mysql-service.yaml
</code></pre>

<pre><code class="language-bash">kubectl delete -f app.yaml
</code></pre>
</section><section>

<h1 id="health-checks">Health Checks</h1>

</section><section>

<h1 id="health-checks-1">Health Checks</h1>

<p>Healthchecks inform that kubelet that pods are ready to accept traffic</p>

<p>The distributed nature of kubernetes allows pods to come and go for a number of reasons, and if many are running
 a application the kubelet needs to know what a &ldquo;healthy&rdquo; pod looks like.</p>

</section><section>

<h3 id="readiness-and-liveliness-https-kubernetes-io-docs-tasks-configure-pod-container-configure-liveness-readiness-probes"><a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-probes/">Readiness and Liveliness</a></h3>

<h2 id="liveliness">Liveliness</h2>

<p>Liveliness checks inform the kubelet that the pod is running. If this check fails the kubelet will attempt to restart the pod.</p>

</section><section>

<h2 id="liveliness-1">Liveliness</h2>

<pre><code class="language-yaml">apiVersion: v1
kind: Pod
metadata:
  labels:
    test: liveness
  name: liveness-exec
spec:
  containers:
  - name: liveness
    image: k8s.gcr.io/busybox
    args:
    - /bin/sh
    - -c
    - touch /tmp/healthy; sleep 30; rm -rf /tmp/healthy; sleep 600
    livenessProbe:
      exec:
        command:
        - cat
        - /tmp/healthy
      initialDelaySeconds: 5
      periodSeconds: 5
</code></pre>

</section><section>

<h3 id="readiness-and-liveliness-https-kubernetes-io-docs-tasks-configure-pod-container-configure-liveness-readiness-probes-1"><a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-probes/">Readiness and Liveliness</a></h3>

<h2 id="readiness">Readiness</h2>

<p>Readiness checks let the kubelet know that the pod is ready to receive traffic. For example if this check fails the Service or Load balancer does send traffic to that pod.</p>

</section><section>

<h2 id="readiness-1">Readiness</h2>

<pre><code class="language-yaml">readinessProbe:
    exec:
      command:
      - cat
      - /tmp/healthy
    initialDelaySeconds: 5
    periodSeconds: 5
</code></pre>
</section><section>

<h3 id="daemonsets">Daemonsets</h3>

<h3 id="louk8cnc-intro-k8s-images-kubernetes-ds-png"><img src="/louk8cnc-intro-k8s/images/kubernetes/ds.png" alt="" /></h3>

</section><section>

<h3 id="daemonsets-1">Daemonsets</h3>

<p>Specialized deployments that will deploy pods on every node in the cluster</p>

<ul>
<li>Running a cluster storage daemon, such as glusterd, ceph, on each node.</li>
<li>Running a logs collection daemon on every node, such as fluentd or logstash.</li>
<li>Running a node monitoring daemon on every node,

<ul>
<li>Prometheus Node Exporter</li>
<li>collectd</li>
<li>Dynatrace OneAgent</li>
<li>AppDynamics Agent</li>
<li>Datadog agent
<br /></li>
</ul></li>
</ul>
</section><section>

<h1 id="microservice-example">Microservice Example</h1>

<p>Git clone <a href="https://github.com/shahadarsh/docker-k8s-workshop">Micro Service Exercises</a></p>
</section><section>

<h3 id="running-kubernetes">Running Kubernetes</h3>

<ul>
<li>GKP</li>
<li>EKS</li>
<li>AKS</li>
<li>On prem</li>
</ul>
</section><section>

<h1 id="extras">Extras</h1>

<ul>
<li>Monitoring</li>
<li>Logging</li>
<li>Security</li>
</ul>
</section><section>

<h1 id="monitoring">Monitoring</h1>

<p><img src="/louk8cnc-intro-k8s/images/pro_dashboard.png" alt="" /></p>

</section><section>

<h1 id="monitoring-1">Monitoring</h1>

<ul>
<li><p><a href="https://github.com/google/cadvisor">cAdvisor</a></p></li>

<li><p><a href="https://prometheus.io/">Prometheus</a></p></li>

<li><p><a href="https://docs.datadoghq.com/integrations/kubernetes/">Datadog</a></p></li>
</ul>
</section><section>

<h1 id="logging">Logging</h1>

<ul>
<li>kubectl logs</li>
<li>Node level</li>
<li>Cluster Level</li>
<li>Side Car</li>
</ul>

</section><section>

<h3 id="logging-1">Logging</h3>

<ul>
<li>kubectl logs</li>
</ul>

<pre><code class="language-yaml">apiVersion: v1
kind: Pod
metadata:
  name: counter
spec:
  containers:
  - name: count
    image: busybox
    args: [/bin/sh, -c,
            'i=0; while true; do echo &quot;$i: $(date)&quot;; i=$((i+1)); sleep 1; done']
</code></pre>

<pre><code class="language-bash">$ kubectl logs counter
0: Mon Jan  1 00:00:00 UTC 2001
1: Mon Jan  1 00:00:01 UTC 2001
2: Mon Jan  1 00:00:02 UTC 2001
</code></pre>

</section><section>

<h1 id="node-level">Node Level</h1>

<p><img src="/louk8cnc-intro-k8s/images/kubernetes/logging-with-node-agent.png" alt="" /></p>

</section><section>

<h1 id="side-car">Side Car</h1>

<p><img src="/louk8cnc-intro-k8s/images/kubernetes/logging-with-streaming-sidecar.png" alt="" /></p>
</section><section>

<h3 id="container-security-primitives">Container security primitives</h3>

<ul>
<li>SElinux</li>
<li>AppArmor</li>
<li><a href="https://docs.docker.com/engine/security/seccomp/#run-without-the-default-seccomp-profile">Seccomp</a></li>
</ul>

</section><section>

<h3 id="container-pipeline">Container Pipeline</h3>

<ul>
<li>Establish a pipeline to build a standard image</li>
<li>Have a versioning policy</li>
<li>Allow to only run images based of the standard image</li>
<li>Use the same OS as the host</li>
<li>Keep the image small</li>
<li>Use a private registry</li>
<li>Don’t embed secrets into images, use Hashicorp Vault</li>
<li><a href="https://www.cisecurity.org/benchmark/docker/">https://www.cisecurity.org/benchmark/docker/</a></li>
<li><a href="https://github.com/docker/docker-bench-security">https://github.com/docker/docker-bench-security</a></li>
</ul>

</section><section>

<h3 id="k8-security">K8 Security</h3>

<ul>
<li>RBAC</li>
<li>NetworkPolicy</li>
<li>TLS</li>
<li>Image Scanning</li>
<li>Aquasec/Twistlock</li>
<li>Integrating with HashiCorp Vault other public cloud secret stores</li>
<li>Investigate using a container based OS (CoreOS, Atomic Linux)</li>
<li>Harden and tweak</li>
<li>Make sure to pass <a href="https://github.com/dev-sec/linux-baseline">https://github.com/dev-sec/linux-baseline</a></li>
</ul>

</section><section>

<h3 id="security-vendors">Security Vendors</h3>

<ul>
<li>Aquasec <a href="https://www.aquasec.com/">https://www.aquasec.com/</a></li>
<li>Twistlock <a href="https://www.twistlock.com/">https://www.twistlock.com/</a></li>
<li>Sysdig Falco <a href="https://www.sysdig.org/falco/">https://www.sysdig.org/falco/</a></li>
</ul>
</section><section>

<h1 id="closing-remarks">Closing remarks</h1>

<p><img src="/louk8cnc-intro-k8s/images/partyparrot.gif" alt="" /></p>

<p>Contact Me:</p>

<p><a href="https://twitter.com/strongjz">@strongjz</a></p>

<p>Email: <a href="mailto:james.strong@contino.io">james.strong@contino.io</a></p>

<p><a href="https://www.contino.io/">contino.io</a></p>
</section>

</div>
      
<div class="line top"></div>
<div class="line bottom"></div>
<div class="line left"></div>
<div class="line right"></div>

    </div>
<script type="text/javascript" src=/louk8cnc-intro-k8s/reveal-hugo/object-assign.js></script>

<a href="/louk8cnc-intro-k8s/reveal-js/css/print/" id="print-location" style="display: none;"></a>
<script type="text/javascript">
  var printLocationElement = document.getElementById('print-location');
  var link = document.createElement('link');
  link.rel = 'stylesheet';
  link.type = 'text/css';
  link.href = printLocationElement.href + (window.location.search.match(/print-pdf/gi) ? 'pdf.css' : 'paper.css');
  document.getElementsByTagName('head')[0].appendChild(link);
</script>

<script type="application/json" id="reveal-hugo-site-params">{"history":true}</script>
<script type="application/json" id="reveal-hugo-page-params">{"highlight_theme":"color-brewer","margin":0.2,"templates":{"hotpink":{"background":"#FF4081","class":"hotpink"}},"transition":"slide","transition_speed":"fast"}</script>

<script src="/louk8cnc-intro-k8s/reveal-js/lib/js/head.min.js"></script>
<script src="/louk8cnc-intro-k8s/reveal-js/js/reveal.js"></script>

<script type="text/javascript">
  
  
  function camelize(map) {
    if (map) {
      Object.keys(map).forEach(function(k) {
        newK = k.replace(/(\_\w)/g, function(m) { return m[1].toUpperCase() });
        if (newK != k) {
          map[newK] = map[k];
          delete map[k];
        }
      });
    }
    return map;
  }
  
  var revealHugoDefaults = { center: true, controls: true, history: true, progress: true, transition: "slide" };
  var revealHugoSiteParams = JSON.parse(document.getElementById('reveal-hugo-site-params').innerHTML);
  var revealHugoPageParams = JSON.parse(document.getElementById('reveal-hugo-page-params').innerHTML);
  
  var options = Object.assign({},
    camelize(revealHugoDefaults),
    camelize(revealHugoSiteParams),
    camelize(revealHugoPageParams));
  Reveal.initialize(options);
</script>

<script type="text/javascript" src="/louk8cnc-intro-k8s/reveal-js/lib/js/classList.js"></script>


<script type="text/javascript" src="/louk8cnc-intro-k8s/reveal-js/plugin/markdown/marked.js"></script>

<script type="text/javascript" src="/louk8cnc-intro-k8s/reveal-js/plugin/markdown/markdown.js"></script>

<script type="text/javascript" src="/louk8cnc-intro-k8s/reveal-js/plugin/highlight/highlight.js"></script>

<script type="text/javascript" src="/louk8cnc-intro-k8s/reveal-js/plugin/zoom-js/zoom.js"></script>


<script type="text/javascript" src="/louk8cnc-intro-k8s/reveal-js/plugin/notes/notes.js"></script>



<script type="text/javascript">
if (hljs)
  hljs.initHighlightingOnLoad();
</script>
    
    


<script type="text/javascript">

Reveal.addEventListener('slidechanged', function(event) {
  console.log("🎞️ Slide is now " + event.indexh);
});
</script>

  </body>
</html>
